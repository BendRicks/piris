<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Users</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}">
    <script th:inline="javascript">
        var _csrfToken = [[${_csrf.token}]]
    </script>
</head>
<body class="main main-dop">
<div class="modal-container" id="modal" style="display: none">
    <div class="modal-background" id="modal-bg"></div>
    <div class="modal-window">
        <div class="modal-window-header">
            <h2 class="modal-window-header-text">Данные пользователя</h2>
            <svg class="modal-window-header-cross" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"
                 height="20px" width="20px" version="1.1" id="modal-header-cross" viewBox="0 0 490 490"
                 xml:space="preserve">
                        <polygon
                                points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490   489.292,457.678 277.331,245.004 489.292,32.337 "/>
                    </svg>
        </div>
        <div class="modal-window-content" id="modal-content">

        </div>
    </div>
</div>
    <div class="navigation-bar">
        <div class="tablinks active" id="defaultOpen" onclick="openTab(event, 'Personal')">
            <img src="https://cdn-icons-png.flaticon.com/128/942/942799.png" width="60%">
            <p>Личная информация</p>
        </div>
        <div class="tablinks" onclick="openTab(event, 'Accounts')">
            <img src="https://cdn-icons-png.flaticon.com/128/5605/5605921.png" width="70%">
            <p>Счета</p>
        </div>
        <div class="tablinks" onclick="openTab(event, 'Obligations')">
            <img src="https://cdn-icons-png.flaticon.com/128/8898/8898421.png" width="70%">
            <p>Договоры</p>
        </div>
        <div class="navigation-bar-element">
            <img src="https://cdn-icons-png.flaticon.com/128/584/584072.png" width="60%">
            <p>ATM</p>
        </div>
        <div class="navigation-bar-element">
            <img src="https://cdn-icons-png.flaticon.com/128/12534/12534727.png" width="60%">
            <p>Администрирование</p>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks, current;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            document.getElementById("tablinks active").style.background = "#79f6f6";
        }
    </script>


    <div class="main-page">
        <div id="Personal" class="tabcontent" style="display: block;">

        </div>


        <div id="Accounts" class="tabcontent">

<!--            <div class="account-item">-->
<!--                <p>iban</p>-->
<!--                <p>iban</p>-->
<!--                <p>iban</p>-->
<!--            </div>-->
<!--            <div class="account-item-hidden">-->
<!--                <p>Буянов хуесос</p>-->
<!--            </div>-->

            <div class="account-item">
                <p>IBAN: ${account.iban}</p>
                <p>имя: ${account.name}</p>
                <p>тип: ${account.type}</p>
                <p>баланс: ${account.balance}</p>

            </div>
            <div class="panel">
                <p>Lorem ipsum...</p>
                <p>Lorem ipsum...</p>
                <p>Lorem ipsum...</p>
                <div class="account-item">
                    <p>IBAN: ${account.iban}</p>
                    <p>имя: ${account.name}</p>
                    <p>тип: ${account.type}</p>
                    <p>баланс: ${account.balance}</p>
                </div>
                <div class="panel">
                    <p>Lorem ipsum...</p>
                    <p>Lorem ipsum...</p>
                </div>

            </div>

            <button class="account-item">Section 2</button>
            <div class="panel">
                <p>Lorem ipsum...</p>
            </div>

            <button class="account-item">Section 3</button>
            <div class="panel">
                <p>Lorem ipsum...</p>
            </div>


            <script>
                var acc = document.getElementsByClassName("account-item");
                var i;

                for (i = 0; i < acc.length; i++) {
                    acc[i].addEventListener("click", function() {
                        /* Toggle between adding and removing the "active" class,
                        to highlight the button that controls the panel */
                        this.classList.toggle("active");

                        /* Toggle between hiding and showing the active panel */
                        var panel = this.nextElementSibling;
                        if (panel.style.display === "block") {
                            panel.style.display = "none";
                        } else {
                            panel.style.display = "block";
                        }
                    });
                }
            </script>

        </div>

        <div id="Obligations" class="tabcontent">
            <h3>Tokyo</h3>
            <p>Tokyo is the capital of Japan.</p>
        </div>
        <a href="/auth/signup">Добавить пользователя</a>
        <div class="users-items-container" id="users-container">
            <h2>Пользователи</h2>
            <script>

                let sexEnum = {MALE: "Мужчина", FEMALE: "Женщина", ATTACK_HELICOPTER: "Атакующий вретолет", CROISSANT: "Круассан"}
                let maritalStatusEnum = {SINGLE: "Одинок/Одинока", MARRIED: "Женат/Замужем"}
                let cityOfResidenceEnum = {MINSK: "Минск", BREST: "Брест", GOMEL: "Гомель", GRODNO: "Гродно", VITEBSK: "Витебск", MOGILEV: "Могилёв"}
                let citizenshipEnum = {REPUBLIC_OF_BELARUS: "Республика Беларусь", REPUBLIC_OF_POLAND: "Rzeczpospolita Polska", RUSSIAN_FEDERATION: "Русня"}
                let disabilityEnum = {NO: "Нет", FIRST_LEVEL: "Первой степени", SECOND_LEVEL: "Второй степени", THIRD_LEVEL: "Третьей степени"}

                window.onload = async () => {

                    await loadUserInfo()

                    document.getElementById("modal-header-cross").addEventListener('click', () => {
                        document.getElementById("modal").style.display = 'none'
                        document.getElementById('modal-content').innerHTML = ''
                    })

                    document.getElementById("modal-bg").addEventListener('click', () => {
                        document.getElementById("modal").style.display = 'none'
                        document.getElementById('modal-content').innerHTML = ''
                    })

                    await getAllUsers();
                }

                async function loadUserInfo() {
                    let response = await fetch(`/auth/me`, {
                        method: 'GET',
                        headers: {
                            'X-CSRF-TOKEN': _csrfToken
                        }
                    })
                    if (response.status == 200) {
                        let user = await response.json()
                        document.getElementById('Personal').innerHTML =
                            `
                    <div class="personal-info">
                        <p>ФИО: ${user.surname} ${user.name} ${user.givenName}</p>
                        <p>Дата рождения: ${user.birthDate}</p>
                        <p>Пол: ${sexEnum[user.sex]}</p>
                        <p>Идентификационный номер: ${user.passportId}</p>
                        <p>Орган, выдавший документ: ${user.competentOrgan}</p>
                        <p>Дата выдачи: ${user.dateOfIssue}</p>
                        <p>Номер паспорта: ${user.passportSerial}</p>
                        <p>Город проживания: ${cityOfResidenceEnum[user.cityOfResidence]}</p>
                        <p>Место рождения: ${user.birthLocation}</p>
                        <p>Адрес проживания: ${user.addressOfLiving}</p>
                        <p>Адрес прописки: ${user.placeOfResidence}</p>
                        <p>Домашний телефон: ${user.homePhoneNumber}</p>
                        <p>Мобильный телефон: ${user.mobilePhoneNumber}</p>
                        <p>email: ${user.email}</p>
                        <p>Гражданство: ${citizenshipEnum[user.citizenship]}</p>
                        <p>Семейное положение: ${maritalStatusEnum[user.maritalStatus]}</p>
                        <p>Инвалидность: ${disabilityEnum[user.disability]}</p>
                        <p>Пенсионер: ${user.pensioner === "true" ? "Да" : "Нет"}</p>
                        <p>Ежемесячный доход: ${user.monthlyIncome}</p>
                    </div>
                    `
                    }
                }

                async function openUserModal(id) {
                    let user = await getUser(id)
                    if (user) {
                        let modal = document.getElementById('modal')
                        let container = document.getElementById('modal-content')
                        container.innerHTML = ``
                        modal.style.display = 'block'
                    } else {
                        alert("Произошла ошика при загрузке пользователей")
                    }
                }

                async function getUser(id) {
                    let response = await fetch(`/users/user/${id}`, {
                        method: 'GET',
                        headers: {
                            'X-CSRF-TOKEN': _csrfToken
                        }
                    })
                    if (response.status == 200) {
                        return response.json();
                    }
                    return null;
                }

                async function getAllUsers() {
                    let response = await fetch('/users/get_all_users', {
                        method: 'GET',
                        headers: {
                            'X-CSRF-TOKEN': _csrfToken
                        }
                    })
                    if (response.status == 200) {
                        let container = document.getElementById('users-container')
                        let innerHtml = ''
                        let data = await response.json()
                        for (const el of data) {
                            innerHtml += `
                                <div class="user-item" id="user_${el.id}" onclick="openUserModal(${el.id})">
                                    <p>${el.surname} ${el.name} ${el.givenName}</p>
                                    <p>${el.passportId}</p>
                                </div>
                            `
                        }
                        container.innerHTML = innerHtml
                        // console.log()
                    } else {
                        alert("Произошла ошика при загрузке пользователей")
                    }
                }

            </script>
        </div>
    </div>
</body>
</html>